---
title: "Zigで子・孫のモジュール（依存関係）を使う方法 (zig 0.13.0)"
closed: true
archived: false
created_at: "2025-01-23"
---
{
  "comments": [
    {
      "author": "funatsufumiya",
      "created_at": "2025-01-23",
      "body_markdown": "現状zig 0.13.0では、子や孫になっている依存関係と同じモジュールを別のモジュールとして`build.zig.zon`で利用すると、`error: file exists in multiple modules` と怒られてしまう。\n\n以下でどのように解決したかを備忘録としてメモ。\n\nhttps://github.com/Interrupt/delve-framework/issues/77\n\nこのケースの場合は、以下のような依存関係ツリーになっていて、delve内で使われているsokolをアプリケーション側でも `@import(\"sokol\")` できるようにするのが目的だった。（ちなみに別名でimportしても構わない場合は、Issue内の議論の通り、他にも方法はある。）\n\n```txt\napp\n |--- delve\n        |\n        |-- sokol\n```",
      "body_updated_at": "2025-01-23"
    },
    {
      "author": "funatsufumiya",
      "created_at": "2025-01-23",
      "body_markdown": "基本的には[Close直前のコメント](https://github.com/Interrupt/delve-framework/issues/77#issuecomment-2607263026)に書いた通りで、\n\n(1) 使いたい（孫）モジュールを持っている（子）依存関係の `build.zig` で、dependencyのmoduleをそのまま使って、子のモジュールとして孫のモジュールを公開（露出）する。\n\n（例: ここでは、delveというライブラリで使っているsokolをモジュールとして公開する。）\n\n```zig\n// Add sokol as module, using dependency module itself\ntry b.modules.put(\"sokol\", dep_sokol.module(\"sokol\"));\n```\n\nhttps://github.com/funatsufumiya/delve-framework/blob/1211a792c9795642f564ce6c6b9e1b7c8334acfd/build.zig#L117 \n\n(2) こうすることで孫モジュールが子のモジュールとして使えるようになるので、あとはアプリケーション側の `build.zig` で `addImport` する。\n\n（例: `delve`が元々モジュールとして使えていて、(1)でそれと同列に`sokol`を公開しているので、使い方はそれと同じ。）\n\n```zig\nexe.root_module.addImport(\"sokol\", delve_dep.module(\"sokol\"));\n// just like:\n// exe.root_module.addImport(\"delve\", delve_dep.module(\"delve\"));\n```\n\nhttps://github.com/funatsufumiya/zig-delve-pbr-study/blob/25310f578f7a4d59df9cd21f96212a6ef6f685c7/build.zig#L48",
      "body_updated_at": "2025-01-23"
    },
    {
      "author": "funatsufumiya",
      "created_at": "2025-01-23",
      "body_markdown": "前述の(1),(2)の手順を踏めば、あとはアプリケーション側でも子が使っていたモジュール（ここでは `@import(\"sokol\")`）が同じように使えるようになる。\n\nなお、(1)が自分の持っているライブラリではなくてやりづらい場合は、フォークしていじるしかない。フォークしたものは以下のようにコミットIDを指定して依存関係 (`build.zig.zon`) に含められるので、場合によってはフォークが乱立することになるかもしれないが、一応修正は簡単にできる。\n\n```bash\n$ zig fetch --save git+https://github.com/funatsufumiya/delve-framework#3e44be1e4efb8d88edbed889a48d1ebca9cbb0f1\n```",
      "body_updated_at": "2025-01-23"
    },
    {
      "author": "funatsufumiya",
      "created_at": "2025-01-23",
      "body_markdown": "このスクラップにメモしている内容は、おそらくzigの依存関係解決が進化すれば、自然解決していくものと思われるので、現状の暫定策でもありつつ、子のモジュールと全く同じバージョンを同じように使いたい場合には今後も有用と思われる。\nhttps://github.com/ziglang/zig/issues/14288"
    }
  ]
}
