---
title: "build.zig.zonを使ったZigの新しいパッケージ管理 (Zig 0.11〜0.13)"
emoji: "📚"
type: "tech"
topics:
  - "zig"
published: true
published_at: "2023-06-01 04:24"
---

:::message
【2025/1/17 追記】当記事の内容は、Zig 0.11〜0.13 にかけて正式に標準機能となり、多くのGitHub上のライブラリに`build.zig.zon`が設定され、ライブラリのインストールがとてもスムーズになりました。

下記内容は0.13.0がstableである今も概ね変わらず使える内容になっていますが、今後古くなる可能性があります。（これを踏まえて、タイトルにも`(Zig 0.11〜0.13)`を付記しました。）

以下、Zig 0.11がまだNightlyだった時代の内容であることにご留意ください。
:::

執筆時点でまだNightly (master)の機能なので、今後どんどん変わっていく可能性があるけれど、Zigのビルドシステムにnpmやpipのようなパッケージマネージャーを追加しようという動きがv0.11.0-devから始まっていて、その現時点での使い方として、zapのREADMEがとてもわかりやすい。

https://github.com/zigzap/zap/#using-zap-in-your-own-projects

要約すると以下の通り。

- build.zig.zon[^1] (npmでいうところのpackage.json) を以下のように作る。（【2025/1 追記】`zig fetch --save git+https://github.com/xxxxxxx` により作成できます。）

```zig:build.zig.zon
.{
    .name = "My example project",
    .version = "0.0.1",

    .dependencies = .{
        // zap v0.1.6-pre
        .zap = .{
            .url = "https://github.com/zigzap/zap/archive/refs/tags/v0.1.6-pre.tar.gz",
            .hash = "1220a3eab193523b30721dae56a763468b7348b3d1f0b3364d68f6d548c753a72c5a",
        }
    }
}
```

- build.zig (pythonでいうところのsetup.py) に以下を追記。

```zig:build.zig
// 前略
const zap = b.dependency("zap", .{
    .target = target,
    .optimize = optimize,
}); // ここでbuild.zig.zonの情報を読み取ってくれる
exe.addModule("zap", zap.module("zap"));
exe.linkLibrary(zap.artifact("facil.io")); // 指定がある場合のみ
// 後略
```

これだけでライブラリが使えるようになるので、今までの手動でのgit cloneからするとだいぶパッケージマネージャーっぽくなった。たぶん、linkLibraryなんかも今後自動解決するようになるはずで、この辺の自動解決や自動生成を `zig pkg` コマンドでできるようにするらしい。v0.11.0〜v0.13.0で随時リリース予定とのこと。（【2025/1 追記】`zig fetch` コマンドになりました。）

https://github.com/ziglang/zig/projects/4

ちなみに上記のbuild.zig.zonを早速使ってみようとすると、v0.11.0-devで行われた破壊的変更のために、大半のライブラリのbuild.zigが正しく読み取れないので、まだちょっと時期尚早。今後に期待。

https://devlog.hexops.com/2023/zig-0-11-breaking-build-changes/

なお現時点でも使えるサードパーティのZig用パッケージマネージャーは既にいくつかあるのだけれど、gyroが個人的には便利そう。gyro.zzzというYAMLっぽい記法も、build.zig.zonと構造はかなり似ているので、正式リリース後の移行も楽そう。
https://github.com/mattnite/gyro

[^1]: .zonというのはZig Object Notationのことで、Zigの[Anonymous Struct](https://ziglang.org/documentation/0.6.0/#Anonymous-Struct-Literals) ([Anonymous List](https://ziglang.org/documentation/0.6.0/#Anonymous-List-Literals)) 記法を使ったjsonのようなもの。